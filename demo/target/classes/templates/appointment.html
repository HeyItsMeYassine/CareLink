<!DOCTYPE html>
<!-- Page de prise de rendez-vous (patient) : formulaire multi-étapes (filtres → médecin → date/heure → confirmation). -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Appointment - CareLink</title>

  <!-- Styles spécifiques de la page -->
  <link rel="stylesheet" th:href="@{/assets/css/appointment.css}">
  <link rel="icon" th:href="@{/assets/images/doctor.png}" type="image/png">

  <!-- Icônes Bootstrap (utilisées dans les boutons et la barre de progression) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
<header class="header">
  <div class="header-content">
    <!-- Logo : retour rapide au dashboard patient -->
    <div class="logo" onclick="window.location.href='/patient/dashboard'">
      <div class="logo-icon" aria-hidden="true"><i class="bi bi-heart-pulse-fill"></i></div>
      <span class="logo-text">CareLink</span>
    </div>

    <div class="header-controls">
      <!-- Bouton retour -->
      <button class="icon-btn"
              th:onclick="|window.location.href='@{/patient/dashboard}'|"
              type="button" aria-label="Back" title="Back">
        <i class="bi bi-arrow-left"></i>
      </button>
    </div>
  </div>
</header>

<main>
  <!-- Titre + description -->
  <div class="page-header">
    <h1 class="page-title">Book New Appointment</h1>
    <p class="page-description">Follow the steps to schedule your medical appointment</p>
  </div>

  <!-- Barre de progression (4 étapes) -->
  <div class="progress-bar">
    <div class="progress-steps">
      <div class="progress-step">
        <div class="step-circle active" id="step-1-circle">1</div>
        <div class="step-line inactive" id="line-1"></div>
      </div>
      <div class="progress-step">
        <div class="step-circle inactive" id="step-2-circle">2</div>
        <div class="step-line inactive" id="line-2"></div>
      </div>
      <div class="progress-step">
        <div class="step-circle inactive" id="step-3-circle">3</div>
        <div class="step-line inactive" id="line-3"></div>
      </div>
      <div class="progress-step">
        <div class="step-circle inactive" id="step-4-circle">4</div>
      </div>
    </div>

    <!-- Libellés des étapes -->
    <div class="progress-labels">
      <span>Filters</span>
      <span>Doctor</span>
      <span>Date & Time</span>
      <span>Confirm</span>
    </div>
  </div>

  <!-- Carte principale (contenu dynamique géré par appointment.js) -->
  <div class="card">
    <div class="card-header">
      <!-- Titre/description mis à jour à chaque étape via JS -->
      <h2 class="card-title" id="card-title">Select Filters</h2>
      <p class="card-description" id="card-description">Choose wilaya and specialty to find doctors</p>
    </div>

    <div class="card-content">

      <!-- Étape 1 : choix wilaya + spécialité -->
      <div id="step-1">
        <div class="form-group">
          <label for="wilaya-select">Wilaya</label>
          <select id="wilaya-select">
            <option value="">Select a wilaya</option>
          </select>
        </div>

        <div class="form-group">
          <label for="specialty-select">Specialty</label>
          <select id="specialty-select" disabled>
            <option value="">Select a specialty</option>
          </select>
        </div>

        <!-- Navigation étape 1 -->
        <div class="button-group">
          <div></div>
          <button class="btn-primary" id="next-1" disabled>
            Next <i class="bi bi-arrow-right ms-1"></i>
          </button>
        </div>
      </div>

      <!-- Étape 2 : liste des médecins + filtre ville optionnel -->
      <div id="step-2" class="hidden">
        <div class="form-group">
          <label for="city-filter-select">City (optional)</label>
          <select id="city-filter-select" disabled>
            <option value="">All cities</option>
          </select>
        </div>

        <!-- Contenu généré par JS : cartes médecins -->
        <div id="doctors-list"></div>

        <!-- Navigation étape 2 -->
        <div class="button-group">
          <button class="btn-secondary" id="back-2">
            <i class="bi bi-arrow-left me-1"></i> Back
          </button>
          <button class="btn-primary" id="next-2" disabled>
            Next <i class="bi bi-arrow-right ms-1"></i>
          </button>
        </div>
      </div>

      <!-- Étape 3 : calendrier + créneaux horaires -->
      <div id="step-3" class="hidden">
        <div class="form-group">
          <label>Select Date</label>
          <div class="calendar-container">
            <!-- Calendrier généré par JS -->
            <div class="calendar" id="calendar"></div>
          </div>
        </div>

        <!-- Créneaux horaires (affichés après sélection d’une date) -->
        <div class="form-group hidden" id="time-group">
          <label>Select Time</label>
          <div class="time-slots" id="time-slots"></div>
        </div>

        <!-- Navigation étape 3 -->
        <div class="button-group">
          <button class="btn-secondary" id="back-3">
            <i class="bi bi-arrow-left me-1"></i> Back
          </button>
          <button class="btn-primary" id="next-3" disabled>
            Next <i class="bi bi-arrow-right ms-1"></i>
          </button>
        </div>
      </div>

      <!-- Étape 4 : récapitulatif + confirmation -->
      <div id="step-4" class="hidden">
        <!-- Résumé généré par JS -->
        <div class="confirmation-box" id="confirmation-details"></div>

        <!-- Navigation étape 4 -->
        <div class="button-group">
          <button class="btn-secondary" id="back-4">
            <i class="bi bi-arrow-left me-1"></i> Back
          </button>
          <button class="btn-primary" id="confirm-appointment">
            <i class="bi bi-check2-circle me-1"></i> Confirm Appointment
          </button>
        </div>
      </div>

    </div>
  </div>
</main>

<!-- Zone des notifications toast (gérée par appointment.js) -->
<div id="toast-container" class="toast-container"></div>

<!-- Script principal : logique multi-étapes + appels API -->
<script th:src="@{/assets/js/appointment.js}"></script>
</body>
</html>
